# 2026-01-24 Daily Log

## Projects
Implemented the [[nacre]] merge layer today — this is where extracted entities become graph nodes and edges. The co-occurrence threshold system is working: two entities appearing in the same section once creates a pending edge. On the second observation, it graduates to a real edge. This prevents spurious connections from one-time coincidences.

**Marcus** and I pair-programmed the merge logic. He caught that we were creating duplicate temporal edges between entities in different sections of the same file. Fixed by normalizing the edge ID to always put the smaller node ID first.

Touched [[reef]] to update the agent spawn configuration. **Alex** is adding support for concurrent agent pools.

## Implementation
The merge process for each file:
1. Resolve entities to canonical node IDs
2. Create or reinforce nodes (increment mentionCount, update lastReinforced)
3. Create explicit edges for wikilinks
4. Track co-occurrence pairs and graduate when threshold met
5. Create temporal edges between entities in different sections
6. Detect causal language and create directed causal edges

The **entity resolution** pipeline resolved "Marcus", "marcus", and "Marcus S" to the same node on the first test run. Exactly what we wanted. #architecture

## Tools
Heavy use of **TypeScript** generics in the merge layer. The `Omit<MemoryNode, 'id'> & { id?: string }` pattern for optional ID generation is clean. Using `Node.js` crypto module for SHA-256 hashing.

## Decisions
Decided to track pending edges in a **separate JSON file** rather than inside graph.json. This keeps the graph clean — it only contains graduated edges. Due to this separation, the pending edges can be safely discarded if we change the threshold without corrupting the main graph.

## Lessons
**Edge ID normalization prevents duplicate edges** — always sort node IDs alphabetically in the edge ID so A→B and B→A map to the same edge. Simple fix, prevents a whole class of bugs.
